install_opencode() {
    set -o nounset
    set -o pipefail
    IFS=$'\n\t'

    # Define colors for output
    if [ -t 1 ] && [ -n "$TERM" ] && [ "$TERM" != "dumb" ]; then
        red='\e[31m'
        green='\e[32m'
        yellow='\e[33m'
        cyan='\e[36m'
        reset='\e[0m'
    else
        red=''
        green=''
        yellow=''
        cyan=''
        reset=''
    fi

    # Helper functions for logging
    info() { echo >&2 -e "${cyan}[i] $*${reset}"; }
    pass() { echo >&2 -e "${green}[O] $*${reset}"; }
    fail() { echo >&2 -e "${red}[X] $*${reset}"; return 1; }
    if command -v pnpm &> /dev/null; then
        info "Installing Opencode with pnpm..."
        pnpm install -g opencode-ai@latest
    elif command -v npm &> /dev/null; then
        info "Installing Opencode with npm..."
        npm install -g opencode-ai@latest
    else
        fail "Neither npm nor pnpm is installed"
    fi
    pass "Starting Opencode terminal..."
    exec opencode
}